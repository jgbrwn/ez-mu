{% if tracks is empty %}
<div class="empty-state">
    <div class="empty-state-icon">ğŸ“š</div>
    <p>{% if query %}No tracks match "{{ query }}"{% else %}Your library is empty{% endif %}</p>
    <p style="font-size: 13px; margin-top: 8px;">{% if query %}Try a different search{% else %}Search and download music to build your collection{% endif %}</p>
</div>
{% else %}
{% for track in tracks %}
<div class="result-item track-item">
    <input type="checkbox" class="track-checkbox" name="tracks[]" value="{{ track.id }}">
    <button type="button" class="track-play-btn" data-id="{{ track.id }}" onclick="playTrack('{{ track.id }}', '{{ track.title|e('js') }}', '{{ track.artist|e('js') }}', '{{ track.thumbnail|e('js') }}')">
        â–¶
    </button>
    {% if track.thumbnail %}
    <img class="result-thumb" src="{{ track.thumbnail }}" alt="" loading="lazy" style="width: 48px; height: 48px;" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
    <div class="result-thumb" style="display:none;width:48px;height:48px;background:var(--bg-tertiary);align-items:center;justify-content:center;font-size:18px;">ğŸµ</div>
    {% else %}
    <div class="result-thumb" style="width:48px;height:48px;background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center;font-size:18px;">ğŸµ</div>
    {% endif %}
    <div class="result-info" style="flex: 1;">
        <div class="result-title">{{ track.title }}</div>
        <div class="result-meta">
            {{ track.artist }}
            {% if track.duration %}
            â€¢ {{ (track.duration / 60)|number_format(0) }}:{{ '%02d'|format(track.duration % 60) }}
            {% endif %}
        </div>
        <div class="result-badges">
            {% if track.source %}
            <span class="source-badge {{ track.source }}">{{ track.source|upper }}</span>
            {% endif %}
            <span class="source-badge" style="background: var(--bg-tertiary); color: var(--text-secondary);">{{ track.codec|upper }}</span>
            {% if track.bitrate %}
            <span style="font-size: 11px; color: var(--text-secondary);">{{ track.bitrate }} kbps</span>
            {% endif %}
        </div>
    </div>
    <button 
        type="button"
        class="delete-btn clear-btn" 
        style="padding: 6px 12px; font-size: 12px;"
        data-track-id="{{ track.id }}"
        data-track-title="{{ track.title|e('html_attr') }}"
        onclick="confirmDelete(this)"
    >
        ğŸ—‘
    </button>
</div>
{% endfor %}

{# Pagination #}
{% if totalPages is defined and totalPages > 1 %}
<div class="pagination" style="margin-top: 16px;">
    {% if page > 1 %}
    <button 
        class="page-btn" 
        hx-get="/partials/library?page={{ page - 1 }}&sort={{ sort }}&q={{ query|url_encode }}"
        hx-target="#library-list"
        hx-swap="innerHTML"
    >
        â† Prev
    </button>
    {% endif %}
    
    <span style="color: var(--text-secondary); font-size: 13px;">
        Page {{ page }} of {{ totalPages }}
    </span>
    
    {% if page < totalPages %}
    <button 
        class="page-btn" 
        hx-get="/partials/library?page={{ page + 1 }}&sort={{ sort }}&q={{ query|url_encode }}"
        hx-target="#library-list"
        hx-swap="innerHTML"
    >
        Next â†’
    </button>
    {% endif %}
</div>
{% endif %}
{% endif %}
